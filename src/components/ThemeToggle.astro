---
const id = "tg-theme-toggle";
---

<button
  id={id}
  type="button"
  class="inline-flex items-center justify-center rounded-xl border border-[rgb(var(--border))] bg-[rgb(var(--surface))] p-2 shadow-sm transition hover:-translate-y-0.5 hover:border-[rgb(var(--primary)/0.6)] hover:shadow-md"
  aria-label="Toggle theme"
  aria-pressed="false"
>
  <!-- Sun -->
  <svg
    data-icon="sun"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    style="display:none"
  >
    <circle cx="12" cy="12" r="4"></circle>
    <path d="M12 2v2"></path>
    <path d="M12 20v2"></path>
    <path d="M4.93 4.93l1.41 1.41"></path>
    <path d="M17.66 17.66l1.41 1.41"></path>
    <path d="M2 12h2"></path>
    <path d="M20 12h2"></path>
    <path d="M4.93 19.07l1.41-1.41"></path>
    <path d="M17.66 6.34l1.41-1.41"></path>
  </svg>

  <!-- Moon -->
  <svg
    data-icon="moon"
    width="18"
    height="18"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    style="display:none"
  >
    <path d="M21 12.8A8.5 8.5 0 0 1 11.2 3 7 7 0 1 0 21 12.8z"></path>
  </svg>
</button>

<script is:inline>
(() => {
  const STORAGE_KEY = "tg-theme";
  const btn = document.getElementById("tg-theme-toggle");
  if (!btn) return;

  const root = document.documentElement;

  const getTheme = () =>
    root.getAttribute("data-theme") ||
    (root.classList.contains("dark") ? "dark" : "light");

  const setTheme = (theme) => {
    root.setAttribute("data-theme", theme);
    root.classList.toggle("dark", theme === "dark");
    root.style.colorScheme = theme;
    localStorage.setItem(STORAGE_KEY, theme);

    btn.setAttribute("aria-pressed", theme === "dark" ? "true" : "false");
    btn.setAttribute(
      "aria-label",
      theme === "dark" ? "Switch to light theme" : "Switch to dark theme"
    );

    const sun = btn.querySelector('[data-icon="sun"]');
    const moon = btn.querySelector('[data-icon="moon"]');
    if (sun && moon) {
      sun.style.display = theme === "dark" ? "none" : "block";
      moon.style.display = theme === "dark" ? "block" : "none";
    }
  };

  const toggle = () => setTheme(getTheme() === "dark" ? "light" : "dark");

  // Init on load + Astro page transitions
  const init = () => setTheme(getTheme());
  document.addEventListener("DOMContentLoaded", init);
  document.addEventListener("astro:page-load", init);

  btn.addEventListener("click", toggle);
})();
</script>
